<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Touringbank - 巡演机会雷达</title>

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>

<body class="bg-gray-100">

    <!-- 顶部导航栏 -->
    <div class="px-8 py-3 flex items-center bg-gray-900 fixed top-0 left-0 right-0 z-50">
        <div class="flex items-center">
            <div class="text-white font-bold text-xl">Touringbank</div>
            <span class="text-blue-400 text-sm ml-2">BETA</span>
        </div>

        <div class="ml-auto flex items-center" id="userSection">
            <!-- 未登录状态 -->
            <a href="Login.html" id="loginLink"
                class="text-gray-400 hover:text-white text-sm flex items-center transition-colors">
                <i class="fas fa-user mr-2"></i>登录
            </a>

            <!-- 已登录状态 -->
            <div id="userMenu" class="hidden relative">
                <button id="userMenuBtn"
                    class="text-white text-sm flex items-center transition-colors hover:text-blue-400">
                    <i class="fas fa-user-circle mr-2 text-lg"></i>
                    <span id="userEmail"></span>
                    <i class="fas fa-chevron-down ml-2 text-xs"></i>
                </button>

                <!-- 下拉菜单 -->
                <div id="userDropdown"
                    class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50">
                    <a href="Userpage.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                        <i class="fas fa-list mr-2"></i>我的清单
                    </a>
                    <hr class="my-2">
                    <a href="#" id="logoutBtn" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">
                        <i class="fas fa-sign-out-alt mr-2"></i>退出登录
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- 搜索区 - 全屏蓝色背景 -->
    <div class="bg-gradient-to-r from-gray-900 to-blue-900 min-h-screen flex flex-col items-center justify-center px-8">
        <div class="max-w-4xl text-center mb-8">
            <p class="text-5xl font-bold text-white mb-4">巡演机会雷达</p>
            <p class="text-xl text-gray-300">快速发现全球巡演项目在你的目标市场是否有空档期</p>
        </div>

        <div class="w-full max-w-3xl relative flex items-center">
            <select id="regionSelect"
                class="h-full py-4 pl-6 pr-8 rounded-l-lg text-lg bg-gray-50 border-r border-gray-200 focus:outline-none text-gray-700 appearance-none cursor-pointer hover:bg-gray-100 transition-colors">
                <option value="北美">北美</option>
                <option value="欧洲">欧洲</option>
                <option value="中国大陆">中国大陆</option>
                <option value="港台">港台</option>
                <option value="日韩">日韩</option>
                <option value="东南亚">东南亚</option>
                <option value="大洋洲">大洋洲</option>
            </select>
            <div class="relative w-full">
                <input id="searchInput"
                    class="w-full py-4 px-6 rounded-r-lg text-lg bg-white shadow-lg border-0 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="搜索艺人、项目或IP名称..." type="text" />
                <button id="searchBtn"
                    class="absolute right-2 top-1.5 bg-blue-600 text-white px-6 py-2.5 rounded-md text-lg font-medium hover:bg-blue-700 transition-colors">
                    搜索
                </button>
            </div>
        </div>

        <div class="mt-6 flex space-x-4 text-sm text-blue-300">
            <p>热门搜索:</p>
            <p class="cursor-pointer hover:text-white transition-colors">王嘉尔</p>
            <p class="cursor-pointer hover:text-white transition-colors">Final Fantasy</p>
            <p class="cursor-pointer hover:text-white transition-colors">宫崎骏交响</p>
        </div>
    </div>

    <!-- Firebase配置 -->
    <script src="js/firebase-config.js"></script>

    <!-- 交互脚本 -->
    <script>
        // 用户状态监听
        auth.onAuthStateChanged(function (user) {
            const loginLink = document.getElementById('loginLink');
            const userMenu = document.getElementById('userMenu');
            const userEmail = document.getElementById('userEmail');

            if (user) {
                // 用户已登录
                console.log('当前用户:', user);

                // 隐藏登录链接，显示用户菜单
                loginLink.classList.add('hidden');
                userMenu.classList.remove('hidden');

                // 显示用户邮箱（或显示名）
                const displayText = user.displayName || user.email.split('@')[0];
                userEmail.textContent = displayText;

            } else {
                // 用户未登录
                console.log('用户未登录');

                // 显示登录链接，隐藏用户菜单
                loginLink.classList.remove('hidden');
                userMenu.classList.add('hidden');
            }
        });

        // 用户菜单下拉功能
        const userMenuBtn = document.getElementById('userMenuBtn');
        const userDropdown = document.getElementById('userDropdown');

        if (userMenuBtn) {
            userMenuBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                userDropdown.classList.toggle('hidden');
            });

            // 点击其他地方关闭下拉菜单
            document.addEventListener('click', function () {
                userDropdown.classList.add('hidden');
            });
        }

        // 退出登录
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', async function (e) {
                e.preventDefault();

                try {
                    await auth.signOut();
                    console.log('退出登录成功');
                    alert('已退出登录');
                    // 刷新页面
                    window.location.reload();
                } catch (error) {
                    console.error('退出登录失败:', error);
                    alert('退出登录失败');
                }
            });
        }

        // 搜索跳转逻辑 - 要求登录
        const searchBtn = document.getElementById('searchBtn');
        const searchInput = document.getElementById('searchInput');
        const regionSelect = document.getElementById('regionSelect');

        function doSearch() {
            // 检查用户是否登录
            const currentUser = auth.currentUser;

            if (!currentUser) {
                // 未登录，提示并跳转到登录页
                alert('请先登录后再进行搜索');
                window.location.href = 'Login.html';
                return;
            }

            const val = searchInput.value.trim();
            const region = regionSelect.value;

            if (val) {
                // 跳转到 Main.html 并带上参数
                window.location.href = `Main.html?project=${encodeURIComponent(val)}&region=${encodeURIComponent(region)}`;
            } else {
                alert('请输入搜索内容');
            }
        }

        searchBtn.addEventListener('click', doSearch);

        // 允许回车搜索
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                doSearch();
            }
        });
    </script>

</body>

</html>